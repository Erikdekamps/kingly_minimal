{#
/**
 * @file
 * Theme override for a form element.
 *
 * REFACTORED: This bridge template now passes additional props (`id` and `required`)
 * to the `form-element` component, which are needed by the new `form-label`
 * component it now includes.
 *
 * This version also includes a critical fix to prevent a fatal "Array to string"
 * error when handling description attributes.
 *
 * @see kingly_minimal/components/form-element/form-element.twig
 */
#}
{% set classes = [
  'js-form-item',
  'form-item-' ~ name|clean_class,
  'js-form-type-' ~ type|clean_class,
  'js-form-item-' ~ name|clean_class,
  title_attributes.id ? 'form-item--id-' ~ title_attributes.id,
  label_display == 'invisible' ? 'form-item--label-invisible',
  disabled ? 'form-item--disabled',
  errors ? 'form-item--error',
  prefix ? 'form-item--prefix-attached',
  suffix ? 'form-item--suffix-attached',
] %}
{% set description_classes = [
  'form-item__description',
  description_display == 'invisible' ? 'visually-hidden',
] %}

{#
CRITICAL FIX: Safely handle the description attributes.
1. Use `create_attribute()` to ensure `description_attributes` is a valid
   Attribute object, converting the raw array from Drupal if it exists.
2. Use `do` to add the necessary classes to the new object.
This prevents a fatal error.
#}
{% set description_attributes = create_attribute(description.attributes|default({})) %}
{% do description_attributes.addClass(description_classes) %}

{% set label_props = {
  'text': label.text,
  'attributes': label.attributes,
} %}

{% embed 'kingly_minimal:form-element' with {
  label: label_props,
  label_display: label_display,
  description: description ? {
    '#type': 'html_tag',
    '#tag': 'div',
    '#value': description.content,
    '#attributes': description_attributes,
  },
  description_display: description_display,
  errors: errors,
  prefix: prefix,
  suffix: suffix,
  attributes: attributes.addClass(classes),
  id: id,
  required: required,
} %}

  {% block content %}
    {# The 'children' variable contains the actual <input>, <select>, etc. #}
    {{ children }}
  {% endblock %}

{% endembed %}
