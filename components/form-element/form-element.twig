{#
/**
 * @file
 * Theme override for a form element.
 *
 * This bridge template safely handles the description attributes by converting
 * them to a proper Attribute object before modification.
 *
 * @see kingly_minimal/components/form-element/form-element.twig
 */
#}
{% set classes = [
  'js-form-item',
  'form-item-' ~ name|clean_class,
  'js-form-type-' ~ type|clean_class,
  'js-form-item-' ~ name|clean_class,
  title_attributes.id ? 'form-item--id-' ~ title_attributes.id,
  label_display == 'invisible' ? 'form-item--label-invisible',
  disabled ? 'form-item--disabled',
  errors ? 'form-item--error',
  prefix ? 'form-item--prefix-attached',
  suffix ? 'form-item--suffix-attached',
] %}
{% set description_classes = [
  'form-item__description',
  description_display == 'invisible' ? 'visually-hidden',
] %}

{#
FIX: Convert description.attributes (a plain array) into a proper
Attribute object before attempting to add classes to it.
#}
{% set description_attributes = create_attribute(description.attributes|default({})) %}
{% do description_attributes.addClass(description_classes) %}

{% set label_props = {
  'text': label.text,
  'attributes': label.attributes,
} %}

{% embed 'kingly_minimal:form-element' with {
  label: label_props,
  label_display: label_display,
  description: description ? {
    '#type': 'html_tag',
    '#tag': 'div',
    '#value': description.content,
    '#attributes': description_attributes,
  },
  description_display: description_display,
  errors: errors,
  prefix: prefix,
  suffix: suffix,
  attributes: attributes.addClass(classes),
  id: id,
  required: required,
} %}

  {% block content %}
    {# The 'children' variable contains the actual <input>, <select>, etc. #}
    {{ children }}
  {% endblock %}

{% endembed %}
