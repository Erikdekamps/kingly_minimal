{#
/**
 * @file
 * Theme override for a single local task link.
 *
 * This override adds BEM-style classes to the list item and the link, allowing
 * the `local-tasks` SDC to style them correctly. It safely modifies the render
 * arrays to prevent "Array to string" conversion errors.
 *
 * Available variables:
 * - link: A renderable array for the link element.
 * - active: A boolean indicating if the link is active.
 *
 * @see template_preprocess_menu_local_task()
 */
#}
{% set item_classes = [
  'tabs__item',
  active ? 'is-active',
] %}
{#
This is the key to the fix. We are not replacing the attributes array,
but safely adding our class to the existing ones.
#}
{% set link = link|merge({
  '#attributes': {
    'class': link['#attributes']['class']|default([])|merge(['tabs__link'])
  }
}) %}

{# WCAG AAA (2.4.8 Location): Add 'aria-current="page"' to the active tab's link. #}
{% if active %}
  {% set link = link|merge({
    '#attributes': link['#attributes']|merge({'aria-current': 'page'})
  }) %}
{% endif %}
<li{{ attributes.addClass(item_classes) }}>{{ link }}</li>
